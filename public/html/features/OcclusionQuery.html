<!DOCTYPE html><html style="height:100%;"><head lang="en"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="google-site-verification" content="wcRjktXhF6DAjmhneKS7UatweBIkEF6QfqsNhAYbUgg"><title>Occlusion Queries - Babylon.js Documentation</title><link rel="shortcut icon" href="/img/favicon.ico"><meta name="msapplication-TileColor" content="#ffffff"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="https://use.typekit.net/cta4xsb.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/normalize/3.0.3/normalize.min.css"><link rel="stylesheet" href="/css/libs/slideout.css"><link rel="stylesheet" href="/css/libs/highlight/github.css"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/jquery.perfect-scrollbar/0.6.3/css/perfect-scrollbar.min.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/styles/default.min.css"></head><body><nav id="menu"></nav><nav class="nav-main" style="position:inherit;"><!-- Hamburger menu : displayed only in small screens--><i class="fa fa-bars" id="mobilemenu"></i><div class="banner"><div class="menu"><div class="do-not-hover" id="home"><a href="/">HOME</a></div><div class="item" id="whatsnew"><a href="/whats-new">What's new</a></div><div class="item" id="feature"><a href="/babylon101">Babylon 101      </a></div><div class="item" id="feature"><a href="/examples">Examples                        </a></div><div class="item" id="How_To"><a href="/How_To">How To...</a></div><div class="item active" id="feature"><a href="/features">Features</a></div><div class="item" id="resources"><a href="/resources">Resources</a></div><div class="item" id="extensions"><a href="/extensions">Extensions</a></div><div class="item" id="samples"><a href="/snippets">Snippets        </a></div><div class="item" id="classes"><a href="/api">API</a></div><div class="item" id="playground"><a href="/playground">Playground</a></div></div><div class="more"><div class="searchbar"><form method="get" action="/search"><input type="text" name="bjsq" placeholder="Search..."><button type="submit"><i class="fa fa-search"></i></button></form></div></div></div></nav><div id="wrapper"><div class="statics-banner"><div class="img-holder details"><a href="/"><img src="/img/babylonjs_identity_color_dark.svg"></a><a href="/features"><h1>features</h1></a><div></div></div></div><div class="horizontal-separator"></div><div class="static-content"><h1>Occlusion Queries</h1><br><div class="contentTable"><div class="tocHeader"><span class="tocTitle"><i class="tocIcon fa fa-book"></i>Table of contents</span><span class="tocToggle"><i class="fa fa-chevron-up"></i></span></div><div class="tocContent"><ul>
<li><a href="#how-occlusion-queries-works-behind-scenes">How Occlusion Queries works behind scenes</a><ul>
<li><a href="#basics">Basics</a></li>
<li><a href="#advanced">Advanced</a></li>
</ul>
</li>
</ul>
</div></div><div id="staticContent"><h2><a name="introduction" class="anchor" href="#introduction"></a>Introduction</h2><p>Babylon.js v3.1 introduced a new feature: Occlusion Queries.
Occlusion Queries detect whether a Mesh is visible in the current scene or not, and based on that the Mesh get drawn or not. Occlusion Queries is useful when you have an expensive object on the scene and you want to make sure that it will get drawn if it is visible to the camera and it is not behind any opaque object.
BabylonJs provides an implementation for Occlusion Queries using property occlusionType in AbstractMesh Class</p>
<h2><a name="how-occlusion-queries-works-behind-scenes" class="anchor" href="#how-occlusion-queries-works-behind-scenes"></a>How Occlusion Queries works behind scenes</h2><p>Babylon.js engine draw a light transparent bounding box on the targeted Mesh before drawing the object and create a query to check with WebGl engine if the bounding box is visible or not. if the box is visible, the object gets drawn if not the object is not drawn, Occlusion Queries is asynchronous and usually the query result of the object is not available in the current frame and because of this the object is drawn based on a query result of previous frame, the user wouldn&#39;t notice the difference unless your FPS is too low.</p>
<p><a href="https://www.babylonjs-playground.com/#QDAZ80#5">Occlusion Queries Demo</a> - <i class="fa fa-eye" onclick="createIframe('QDAZ80#5', this)"></i><div class="iframeContainer"></div></p>
<h1><a name="basics" class="anchor" href="#basics"></a>Basics</h1><p>To use the Occlusion Queries on a Mesh</p>
<pre><code class="lang-javascript">var sphere = BABYLON.Mesh.CreateSphere(&#39;sphere1&#39;, 16, 2, scene);
sphere.occlusionType = BABYLON.AbstractMesh.OCCLUSION_TYPE_OPTIMISTIC;
</code></pre>
<p>For more about occlusionType and the supported algorithm check AbstractMesh class <a href="/api/classes/babylon.abstractMesh#occlusiontype-number">documentations</a>.</p>
<p>If your object by default is behind an opaque object you can set property <code>isOccluded</code> to true so Babylon.js engine won&#39;t take a decision to render or not until the query result is retrieved from WebGl engine.</p>
<pre><code class="lang-javascript">sphere.isOccluded = true;
</code></pre>
<h1><a name="advanced" class="anchor" href="#advanced"></a>Advanced</h1><p>As described earlier the Occlusion Queries result is asynchronous and it may take some time to get the result and because of this the object would take many frames to be loaded waiting for the query result. In this case you can use property <code>occlusionRetryCount</code> to set the number of waiting frames before query get broken. Once a break happens you will need to decide whether to draw the object or to maintain its state, property <code>occlusionType</code> is used for this reason as you have 2 options
1) OCCLUSION_TYPE_OPTIMISTIC: this option will render the mesh if a break is happened.
2) OCCLUSION_TYPE_STRICT: this option will restore the last state of the object whether visible continue as visible or hidden continue as hidden.</p>
<p>As a scenario of using restrict and optimistic if you have 2 expensive objects in your scene one of them is a must render object so you could set <code>occlusionRetryCount</code> and set the occlusionType to optimistic so your object will be rendered in case the query result is not available. If your object can wait till the query is available, don&#39;t set the <code>occlusionRetryCount</code> or set the property while use occlusionType as Strict so if the object was rendered in the last scene re-render it again in the current scene else hide it.</p>
<pre><code class="lang-javascript">sphere.occlusionRetryCount = 10;
sphere.occlusionType = BABYLON.AbstractMesh.OCCLUSION_TYPE_STRICT;
</code></pre>
<p>In Babylon.js you can also set the WebGl Occlusion Queries algorithm type using property <code>occlusionQueryAlgorithmType</code> for more into check AbstractMesh Class <a href="/api/classes/babylon.abstractMesh#occlusionqueryalgorithmtype-number">documentations</a>.</p>
<p>You can find a live demo here: <a href="https://www.babylonjs-playground.com/#QDAZ80#3">https://www.babylonjs-playground.com/#QDAZ80#3</a> - <i class="fa fa-eye" onclick="createIframe('QDAZ80#3', this)"></i><div class="iframeContainer"></div></p>
</div></div></div><footer class="footer"><div class="footer-item"><a href="https://www.babylonjs.com" target="_blank"><i class="fa fa-home"></i>    Babylonjs.com</a></div><div class="footer-item"><a href="https://forum.babylonjs.com" target="_blank"><i class="fa fa-html5"></i>    Forum</a></div><div class="footer-item"><a href="https://github.com/BabylonJS/Babylon.js" target="_blank"><i class="fa fa-github"></i>    Github</a></div><div class="footer-item"><a href="https://github.com/BabylonJS/Documentation" target="_blank"><i class="fa fa-code-fork"></i>    Contribute </a></div><div class="footer-item"><a href="https://www.netlify.com" target="_blank"><i class="fa fa-heart"></i> Deployed by netlify            </a></div></footer><script src="/js/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/0.1.9/slideout.min.js"></script><script src="/js/index.js"></script><script>(function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            };
    i[r].l = 1 * new Date();
    a = s.createElement(o);
    m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
})(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
ga('create', 'UA-41767310-3', 'auto');
ga('send', 'pageview');</script><!-- HIGHLIGHT JS--><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/languages/javascript.min.js"></script><script src="/js/static.js"></script><script>$('code').each(function(){
    $(this).text($(this).text().replace(/&nbsp;/gi, ''));
});
hljs.initHighlightingOnLoad();</script></body></html>